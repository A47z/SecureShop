<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç•™è¨€æ¿ - SecureShop</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #e7f3ff;
            color: #0066cc;
            border: 1px solid #b3d9ff;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffc107;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
        }

        button {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }

        .test-cases {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
        }

        .test-case {
            background: white;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 3px;
            border-left: 3px solid #f5576c;
            font-family: monospace;
            font-size: 13px;
        }

        .comments {
            margin-top: 40px;
        }

        .comment {
            background: #f9f9f9;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            border-left: 3px solid #667eea;
        }

        .comment-author {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }

        .comment-content {
            color: #333;
            line-height: 1.6;
        }

        .comment-time {
            color: #999;
            font-size: 12px;
            margin-top: 5px;
        }

        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: #667eea;
            text-decoration: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ’¬ ç•™è¨€æ¿ - XSS é˜²æŠ¤æ¼”ç¤º</h1>
        <p class="subtitle">å®éªŒæ­¥éª¤3: ä½¿ç”¨ Thymeleaf th:text è‡ªåŠ¨è½¬ä¹‰é˜²æ­¢ XSS</p>

        <div class="alert alert-info">
            <strong>âœ… å®‰å…¨ä¿è¯ï¼š</strong> æ‰€æœ‰ç”¨æˆ·è¾“å…¥åœ¨æ˜¾ç¤ºæ—¶ä½¿ç”¨ th:text è‡ªåŠ¨è½¬ä¹‰ï¼ŒHTML æ ‡ç­¾ä¼šè¢«è½¬æ¢ä¸ºå®ä½“å­—ç¬¦ï¼Œè„šæœ¬ä¸ä¼šè¢«æ‰§è¡Œã€‚
        </div>

        <div th:if="${warning}" class="alert alert-warning">
            <span th:text="${warning}"></span>
        </div>

        <!-- XSS æµ‹è¯•ç”¨ä¾‹ -->
        <div class="test-cases">
            <h3>ğŸ§ª XSS æµ‹è¯•ç”¨ä¾‹ï¼ˆéƒ½ä¼šè¢«å®‰å…¨è½¬ä¹‰ï¼‰ï¼š</h3>
            <div class="test-case">
                âŒ &lt;script&gt;alert('XSS')&lt;/script&gt;
            </div>
            <div class="test-case">
                âŒ &lt;img src=x onerror=alert('XSS')&gt;
            </div>
            <div class="test-case">
                âŒ &lt;svg onload=alert('XSS')&gt;
            </div>
            <p style="margin-top: 15px; color: #666; font-size: 14px;">
                å¤åˆ¶ä¸Šé¢çš„æµ‹è¯•ç”¨ä¾‹åˆ°è¯„è®ºæ¡†ï¼ŒæŸ¥çœ‹ç³»ç»Ÿå¦‚ä½•å®‰å…¨è½¬ä¹‰è¿™äº›æ¶æ„è„šæœ¬ã€‚
            </p>
        </div>

        <!-- è¯„è®ºè¡¨å• -->
        <form th:action="@{/comments}" th:object="${newComment}" method="post">
            <div class="form-group">
                <label for="content">å‘è¡¨è¯„è®ºï¼š</label>
                <textarea id="content" th:field="*{content}" placeholder="è¯·è¾“å…¥æ‚¨çš„è¯„è®ºå†…å®¹..." required></textarea>
                <div style="color: #c33; font-size: 12px; margin-top: 5px;" th:if="${#fields.hasErrors('content')}"
                    th:errors="*{content}">
                </div>
            </div>
            <button type="submit">æäº¤è¯„è®º</button>
        </form>

        <!-- è¯„è®ºåˆ—è¡¨ -->
        <div class="comments">
            <h3>è¯„è®ºåˆ—è¡¨ (<span th:text="${comments != null ? comments.size() : 0}">0</span>)</h3>

            <div th:if="${comments != null and !comments.isEmpty()}">
                <div th:each="comment : ${comments}" class="comment">
                    <div class="comment-author" th:text="${comment.user.username}">ç”¨æˆ·</div>
                    <!--
                        å®éªŒæ­¥éª¤3: XSS é˜²æŠ¤
                        
                        âœ… ä½¿ç”¨ th:text - è‡ªåŠ¨è½¬ä¹‰ HTML
                        th:text ä¼šå°† < è½¬æ¢ä¸º &lt;ï¼Œ> è½¬æ¢ä¸º &gt;
                        
                        âŒ ä¸è¦ä½¿ç”¨ th:utext - ä¸è½¬ä¹‰ï¼Œå±é™©ï¼
                    -->
                    <div class="comment-content" th:text="${comment.content}">è¯„è®ºå†…å®¹</div>
                    <div class="comment-time" th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm:ss')}">
                        æ—¶é—´
                    </div>
                </div>
            </div>

            <div th:if="${comments == null or comments.isEmpty()}"
                style="padding: 20px; text-align: center; color: #999;">
                æš‚æ— è¯„è®ºï¼Œå¿«æ¥å‘è¡¨ç¬¬ä¸€æ¡è¯„è®ºå§ï¼
            </div>
        </div>

        <a href="/home" class="back-link">â† è¿”å›ä¸»é¡µ</a>
    </div>
</body>

</html>