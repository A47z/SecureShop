# ========================================
# SecureShop 应用配置文件
# 
# 对应 OWASP 实验步骤5: 基本的安全配置指南
# ========================================

# ========================================
# 应用基本配置
# ========================================
spring.application.name=SecureShop

# 服务器端口
server.port=8080

# ========================================
# 数据库配置 (MySQL)
# 
# 实验步骤1: SQL注入预防
# 实验步骤5: 使用低权限用户连接数据库
# ========================================

# 数据库连接URL
# 注意: 使用专门的数据库用户，不要使用root账户
spring.datasource.url=jdbc:mysql://localhost:3306/secureshop_db?useSSL=true&serverTimezone=Asia/Shanghai&characterEncoding=UTF-8

# 数据库用户名
# 实验步骤5: 确保此用户不是数据库管理员，只有必要的权限
spring.datasource.username=secureshop_user

# 数据库密码
# 实验步骤5: 使用强密码
# 生产环境: 应该使用环境变量或配置服务器(如Spring Cloud Config)来管理密码
spring.datasource.password=SecureShop@2024!Strong

# 数据库驱动
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# ========================================
# JPA / Hibernate 配置
# 
# 实验步骤1: 使用JPA参数化查询预防SQL注入
# ========================================

# Hibernate DDL 模式
# 开发环境: update (自动更新表结构)
# 生产环境: validate (只验证表结构，不修改)
spring.jpa.hibernate.ddl-auto=update

# 显示SQL语句 (开发环境启用，生产环境禁用)
spring.jpa.show-sql=true

# 格式化SQL输出
spring.jpa.properties.hibernate.format_sql=true

# SQL方言
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# 数据库连接池配置
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000

# ========================================
# Thymeleaf 配置
# 
# 实验步骤3: XSS防护
# ========================================

# 启用Thymeleaf缓存 (开发环境关闭，生产环境开启)
spring.thymeleaf.cache=false

# Thymeleaf模板路径
spring.thymeleaf.prefix=classpath:/templates/

# Thymeleaf模板后缀
spring.thymeleaf.suffix=.html

# Thymeleaf编码
spring.thymeleaf.encoding=UTF-8

# Thymeleaf模式
spring.thymeleaf.mode=HTML

# ========================================
# Spring Security 配置
# 
# 实验步骤2: 身份验证和会话管理
# 实验步骤8: CSRF防护
# ========================================

# 密码加密算法强度 (BCrypt)
# BCrypt rounds: 10 (推荐值，在安全性和性能之间取得平衡)
spring.security.bcrypt.strength=10

# ========================================
# 会话管理配置
# 
# 实验步骤2: 会话管理
# ========================================

# 会话超时时间 (30分钟)
# 实验步骤2: 设置最少但实际的会话过期时间
server.servlet.session.timeout=30m

# Cookie配置
# 实验步骤2: 始终设置HTTPOnly和安全的Cookie属性
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.same-site=strict

# ========================================
# 错误页面配置
# 
# 实验步骤5: 自定义错误页面
# ========================================

# 禁用默认错误页面的详细信息
server.error.include-exception=false
server.error.include-stacktrace=never
server.error.include-message=never
server.error.include-binding-errors=never

# 错误页面路径
server.error.path=/error

# ========================================
# 日志配置
# 
# 实验步骤5: 安全日志记录
# ========================================

# 日志级别
logging.level.root=INFO
logging.level.com.secureshop=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# 日志文件
logging.file.name=logs/secureshop.log
logging.file.max-size=10MB
logging.file.max-history=30

# ========================================
# 文件上传配置
# 
# 实验步骤1: 输入校验
# 实验步骤6: 敏感数据保护
# ========================================

# 单个文件最大大小
spring.servlet.multipart.max-file-size=5MB

# 请求最大大小
spring.servlet.multipart.max-request-size=10MB

# ========================================
# 验证配置
# 
# 实验步骤1: 输入校验
# ========================================

# 启用Bean Validation
spring.validation.enabled=true

# ========================================
# 生产环境注意事项
# ========================================
# 
# 1. 数据库密码应该使用环境变量:
#    spring.datasource.password=${DB_PASSWORD}
#
# 2. HTTPS配置 (实验步骤2):
#    server.ssl.enabled=true
#    server.ssl.key-store=classpath:keystore.p12
#    server.ssl.key-store-password=${SSL_PASSWORD}
#    server.ssl.key-store-type=PKCS12
#
# 3. HSTS配置 (实验步骤2):
#    在SecurityConfig中配置
#
# 4. 关闭开发工具:
#    spring.devtools.add-properties=false
#
# 5. 关闭SQL日志:
#    spring.jpa.show-sql=false
#    logging.level.org.hibernate.SQL=WARN
#
# 6. Cookie安全标志:
#    server.servlet.session.cookie.secure=true (仅HTTPS)
#
# 7. DDL模式:
#    spring.jpa.hibernate.ddl-auto=validate
