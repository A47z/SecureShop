<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„è®¢å• - SecureShop</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #e7f3ff;
            color: #0066cc;
            border: 1px solid #b3d9ff;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .order-card {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .order-id {
            font-weight: 600;
            color: #333;
        }

        .order-status {
            padding: 5px 15px;
            border-radius: 3px;
            font-size: 14px;
            font-weight: 600;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-paid {
            background: #d4edda;
            color: #155724;
        }

        .status-shipped {
            background: #cce5ff;
            color: #004085;
        }

        .order-detail {
            color: #666;
            line-height: 1.8;
        }

        .order-total {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
            margin-top: 15px;
        }

        .test-info {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
        }

        .test-case {
            background: white;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 3px;
            border-left: 3px solid #667eea;
            font-family: monospace;
            font-size: 13px;
        }

        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: #667eea;
            text-decoration: none;
        }

        button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ“¦ æˆ‘çš„è®¢å• - IDOR é˜²æŠ¤æ¼”ç¤º</h1>
        <p class="subtitle">å®éªŒæ­¥éª¤4: éªŒè¯è®¢å•æ‰€æœ‰æƒï¼Œé˜²æ­¢ä¸å®‰å…¨çš„ç›´æ¥å¯¹è±¡å¼•ç”¨</p>

        <div class="alert alert-info">
            <strong>âœ… å®‰å…¨ä¿è¯ï¼š</strong> ç³»ç»Ÿä¼šéªŒè¯æ‰€æœ‰é‡å®šå‘URLï¼Œåªå…è®¸é‡å®šå‘åˆ°ç™½åå•ä¸­çš„å¯ä¿¡åŸŸåã€‚
        </div>

        <!-- æˆåŠŸæ¶ˆæ¯ -->
        <div th:if="${param.success}" class="alert"
            style="background: #d4edda; color: #155724; border: 1px solid #c3e6cb;">
            <strong>âœ… æˆåŠŸï¼š</strong> æµ‹è¯•è®¢å•å·²åˆ›å»ºï¼
        </div>

        <!-- åˆ›å»ºæµ‹è¯•è®¢å•æŒ‰é’® -->
        <div style="margin-bottom: 30px; text-align: right;">
            <form th:action="@{/orders/create-test}" method="post" style="display: inline;">
                <button type="submit"
                    style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">
                    â• åˆ›å»ºæµ‹è¯•è®¢å•
                </button>
            </form>
            <p style="font-size: 12px; color: #666; margin-top: 5px; text-align: right;">
                åˆ›å»ºéšæœºæµ‹è¯•è®¢å•ä»¥æ¼”ç¤ºIDORé˜²æŠ¤åŠŸèƒ½
            </p>
        </div>

        <!-- IDOR æµ‹è¯•è¯´æ˜ -->
        <div class="test-info">
            <h3>ğŸ§ª IDOR é˜²æŠ¤æµ‹è¯•ï¼š</h3>
            <div class="test-case">
                1. æ³¨å†Œä¸¤ä¸ªç”¨æˆ·è´¦å·ï¼ˆç”¨æˆ·Aå’Œç”¨æˆ·Bï¼‰
            </div>
            <div class="test-case">
                2. ç”¨æˆ·Aç™»å½•åï¼ŒæŸ¥çœ‹è®¢å•è¯¦æƒ…ï¼Œæ³¨æ„URLä¸­çš„è®¢å•ID
            </div>
            <div class="test-case">
                3. ç”¨æˆ·Bç™»å½•åï¼Œå°è¯•è®¿é—®ç”¨æˆ·Açš„è®¢å•URL
            </div>
            <div class="test-case">
                âœ… é¢„æœŸç»“æœï¼š403 Forbidden - "æ— æƒè®¿é—®æ­¤è®¢å•"
            </div>
            <p style="margin-top: 15px; color: #666; font-size: 14px;">
                ç³»ç»Ÿä¼šéªŒè¯ <code>order.belongsToUser(currentUser)</code>ï¼Œç¡®ä¿è®¢å•å±äºå½“å‰ç”¨æˆ·ã€‚
            </p>
        </div>

        <!-- è®¢å•åˆ—è¡¨ -->
        <div th:if="${orders != null and !orders.isEmpty()}">
            <h3>æˆ‘çš„è®¢å• (<span th:text="${orders.size()}">0</span>)</h3>

            <div th:each="order : ${orders}" class="order-card">
                <div class="order-header">
                    <div class="order-id">
                        è®¢å•å·: #<span th:text="${order.id}">1</span>
                    </div>
                    <div class="order-status"
                        th:classappend="${order.status == T(com.secureshop.entity.OrderStatus).PENDING} ? 'status-pending' : 
                                        (${order.status == T(com.secureshop.entity.OrderStatus).PAID} ? 'status-paid' : 'status-shipped')">
                        <span th:text="${order.status}">PENDING</span>
                    </div>
                </div>

                <div class="order-detail">
                    <div>æ”¶è´§äºº: <span th:text="${order.receiverName}">å§“å</span></div>
                    <div>è”ç³»ç”µè¯: <span th:text="${order.receiverPhone}">ç”µè¯</span></div>
                    <div>æ”¶è´§åœ°å€: <span th:text="${order.shippingAddress}">åœ°å€</span></div>
                    <div>ä¸‹å•æ—¶é—´: <span th:text="${#temporals.format(order.createdAt, 'yyyy-MM-dd HH:mm:ss')}">æ—¶é—´</span>
                    </div>
                </div>

                <div class="order-total">
                    æ€»è®¡: Â¥<span th:text="${order.totalAmount}">0.00</span>
                </div>

                <a th:href="@{/orders/{id}(id=${order.id})}" style="text-decoration: none;">
                    <button>æŸ¥çœ‹è¯¦æƒ…</button>
                </a>
            </div>
        </div>

        <!-- ç©ºçŠ¶æ€ -->
        <div th:if="${orders == null or orders.isEmpty()}" class="empty-state">
            <div class="empty-icon">ğŸ“­</div>
            <h3>æš‚æ— è®¢å•</h3>
            <p style="margin-top: 10px;">æ‚¨è¿˜æ²¡æœ‰åˆ›å»ºä»»ä½•è®¢å•</p>
            <p style="margin-top: 20px; font-size: 14px; color: #666;">
                æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªå®‰å…¨æ¼”ç¤ºç³»ç»Ÿï¼Œè®¢å•åŠŸèƒ½ç”¨äºæ¼”ç¤º IDOR é˜²æŠ¤ã€‚<br>
                æ‚¨å¯ä»¥é€šè¿‡åˆ›å»ºå¤šä¸ªç”¨æˆ·è´¦å·æ¥æµ‹è¯• IDOR é˜²æŠ¤æœºåˆ¶ã€‚
            </p>
        </div>

        <a href="/home" class="back-link">â† è¿”å›ä¸»é¡µ</a>
    </div>
</body>

</html>